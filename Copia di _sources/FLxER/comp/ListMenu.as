package FLxER.comp{	import flash.display.Sprite;	import flash.utils.*;	import flash.geom.Point;	import flash.xml.XMLNode;	import flash.events.*;	import FLxER.main.Rett;	import FLxER.comp.ListBox;	public class ListMenu extends Sprite {		var w:Number;		var h:Number;		var txt:String;		var myXml:XMLNode;		var fnz:Function;		var n:Number;		var val;		////		var c:Number;		var conta:Number;		var toppa;		public var lab:ButtonTxt;		var labs:Sprite;		var labsA:Object;		var point:Object;		var alt:String;		var up:Sprite;		var down:Sprite;		var firsTime;		var startVal;		public function ListMenu(xx:Number,yy:Number,ww:uint,hh:uint,t:String,f:Function,alt:String, xml:XMLNode, nn:uint):void {			x = xx;			y = yy;			w=ww;			h=hh;			myXml = xml			fnz = f;			startVal = val = t;			n = nn;			lab = new ButtonTxt(0, 0, w, h, t, apri, null, alt);			this.addChild(lab)			labsA = new Object();			labs = new Sprite();			for (var b=0; b<n; b++) {				labsA["lab"+b] = new ButtonTxt(0, b*hh, ww, hh, " ", seleziona, b, null);				this.labs.addChild(labsA["lab"+b]);			}			up = new Rett(0,-h,w,h,Preferences.pref.myCol.bkgCol,-1,0);			down = new Rett(0,hh*n,w,h,Preferences.pref.myCol.bkgCol,-1,0);			up.addEventListener(MouseEvent.MOUSE_OVER,avvia_scrolla);			up.addEventListener(MouseEvent.MOUSE_OUT,avvia_scrolla);			down.addEventListener(MouseEvent.MOUSE_OVER,avvia_scrolla);			down.addEventListener(MouseEvent.MOUSE_OUT,avvia_scrolla);			this.labs.addChild(down);			this.labs.addChild(up);			if (xml) {				avvia(xml);			}		}		public function resetta():void {			lab.lab.text = startVal;			if (myXml) {				firsTime = true;				conta = 0;				riempi();			}		}		public function avvia(xml:XMLNode):void {			firsTime = true;			conta = 0;			myXml = xml;			riempi();		}		function riempi():void {			for (var d:uint=0; d<n; d++) {				if (d+conta<myXml.childNodes.length) {					//trace("riempi   "+myXml.childNodes[d+conta].attributes.m);					labsA["lab"+d].lab.text = myXml.childNodes[d+conta].attributes.m;				} else {					labsA["lab"+d].lab.text = " ";				}			}		}		function avvia_scrolla(event:Event):void {			var b:Number = (mouseY>0 ? 1 : -1);			if (event.type=="mouseOver") {				c = setInterval(scrolla, 100, b);				scrolla(b);			} else {				clearInterval(c);			}		}		public function scrolla(b:Number):void {			if (conta+b>=0) {				if (b+conta<myXml.childNodes.length) {					conta += (firsTime ? 0 : b);					firsTime = false					riempi();				} else {					clearInterval(c);				}			}		}		public function seleziona(b:uint):void {			firsTime = false			if(toppa) {				if(this.contains(toppa)) {					this.removeChild(toppa)					this.removeChild(labs)				}			}			var p:String = myXml.childNodes[conta+b].attributes.m;			var v:String;			if (myXml.childNodes[conta+b].attributes.val != undefined) {				v = myXml.childNodes[conta+b].attributes.val;			} else {				v = p;			}			setVal(p, v)			fnz(p, v);		}		function apri(t:String):void {			if (!toppa) {				point = new Point(0,0);				//point = this.localToGlobal(point);				toppa = new Rett(-point.x, -point.y, 800, 600, 0xFFFFFF, -1, 0)				toppa.addEventListener(MouseEvent.MOUSE_DOWN, chiudi);			}			this.addChild(toppa)			this.addChild(labs)			this.parent.swapChildren(this, this.parent.getChildAt(this.parent.numChildren-1))		}		function chiudi(b:String):void {			this.removeChild(toppa)			this.removeChild(labs)		}		public function setVal(p:String,v:String):void {			lab.lab.text = p;			val = v;		}		public function myEnable():void {			this.lab.myEnable();		}		public function myDisable():void {			this.lab.myDisable();		}		public function getVal():String {			return val;		}	}}